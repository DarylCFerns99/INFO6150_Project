<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <link rel="stylesheet" href="./css/styles.css" />
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous"><!-- Bootstrap Font Icon CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <!-- Jquery installation -->
    <script
        src="https://code.jquery.com/jquery-3.3.1.js"
        integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
        crossorigin="anonymous"
    ></script>
    <!-- Load header file -->
    <script> 
        $(document).ready(function(){
            $("div#header").load("./header.html");
            $("div#footer").load("./footer.html");
        });
    </script> 
    <!-- external stylesheet -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="header"></div>

    <main>
        <div class="container d-flex justify-content-center align-items-center min-vh-100">
            <div class="row border rounded-5 p-3 bg-white shadow box-area">
                <!-- left box area -->
                <div class="col-md-6 rounded-5 d-flex justify-content-center align-items-center flex-column">
                    <div id="carouselAutoplaying" class="carousel slide carousel-fade" data-bs-ride="carousel">
                        <div class="carousel-inner">
                          <div class="carousel-item active">
                            <img src="/assets/five.jpg" class="d-block w-100 rounded-5" alt="...">
                          </div>
                          <div class="carousel-item">
                            <img src="/assets/four.jpg" class="d-block w-75 rounded-5" alt="...">
                          </div>
                          <div class="carousel-item">
                            <img src="/assets/loginImg.jpg" class="d-block w-75 rounded-5" alt="...">
                          </div>
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleAutoplaying" data-bs-slide="prev">
                          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                          <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleAutoplaying" data-bs-slide="next">
                          <span class="carousel-control-next-icon" aria-hidden="true"></span>
                          <span class="visually-hidden">Next</span>
                        </button>
                      </div>
                </div>

                <!-- right box area -->
                <div class="col-md-6 mt-3">
                    <div class="row align-items-center">
                        <h2>Register</h2>
                    </div>

                    <div id="myForm" class="inputLogin mt-3">
                        <form>
							<div class="d-flex justify-content-between">
								<div>
									<div class="mb-1">
										<label for="firstName" class="form-label">First Name</label>
										<input placeholder="First Name" type="text" class="form-control bg-light fs-6" id="firstName">
									  </div>
									  <div id="error_firstName" style="display: none; color:red;">
										  Invalid First Name format, Please enter a valid name.
									  </div>
								</div>

								<div>
									<div class="mb-1">
										<label for="lastName" class="form-label">Last Name</label>
										<input placeholder="Last Name" type="text" class="form-control bg-light fs-6" id="lastName">
									  </div>
									  <div id="error_lastName" style="display: none; color:red;">
										  Invalid Last Name format, Please enter a valid name.
									  </div>
								</div>

							</div>

							<div id="radio-btns" class="mt-1">
								<h7 class="mt-1"> Gender</h7>
								<div class="d-flex justify-content-around">
									<div class="form-check">
										<input class="form-check-input" type="radio" name="flexRadioDefault" id="checkboxFemale">
										<label class="form-check-label" for="checkboxFemale">
										  Female
										</label>
									</div>
									<div class="form-check">
										<input class="form-check-input" type="radio" name="flexRadioDefault" id="checkboxMale" checked>
										<label class="form-check-label" for="checkboxMale">
										  Male
										</label>
									</div>
	
									<div class="form-check">
										<input class="form-check-input" type="radio" name="flexRadioDefault" id="checkboxOtherGender" checked>
										<label class="form-check-label" for="checkboxOtherGender">
										  Other
										</label>
									</div>
								</div>

							</div>

							

							<div class="mt-1">
								<label for="emaildId" class="form-label">Email address</label>
								<input placeholder="Email Id" type="email" class="form-control bg-light fs-6" id="emailId" aria-describedby="emailHelp">
							</div>
							<div id="error_emailId" style="display: none; color:red;">
								  Invalid Email format, Please enter a Email Address.
							</div>

							
							<div class="mt-2">
								<h7 class="mb-2">Select your Regions</h7>
								<select id="region" class="mb-1 form-select form-select-sm" aria-label=".form-select-sm example">
									<option selected>Regions</option>
									<option value="Massachusetts">Massachusetts</option>
									<option value="Texas">Texas</option>
									<option value="California">California</option>
								  </select>
							</div>
							<div id="error_region" style="display: none; color:red;">
								Please select a Region.
						  	</div>

							<div>
								<div class="mt-1">
									<label for="address1" class="form-label">Address</label>
									<input placeholder="Address line 1" type="text" class="form-control bg-light fs-6" id="address1">
								  </div>
								  <div id="error_address1" style="display: none; color:red;">
									Invalid Address 1 format, Please enter a valid Address 1
								  </div>
							</div>

							<div>
								<div class="mt-1">
									<label for="address2" class="form-label">Address</label>
									<input placeholder="Address line 2" type="text" class="form-control bg-light fs-6" id="address2">
								  </div>
								  <div id="error_address2" style="display: none; color:red;">
									  Invalid Address 2 format, Please enter a valid Address 2
								  </div>
							</div>
                            

                            <div class="mt-1">
                              <label for="pincode" class="form-label">Pincode</label>
                              <input placeholder="Pincode" type="text" class="form-control bg-light fs-6" id="pincode">
                            </div>
                            <div id="error_pincode" style="display: none; color:red;">
                                Invalid Pincode
                            </div>

							<div class="mt-1">
								<label for="phoneNumber" class="form-label">Phone Number</label>
								<input placeholder="Phone Number" type="text" class="form-control bg-light fs-6" id="phoneNumber">
							  </div>
							  <div id="error_phoneNumber" style="display: none; color:red;">
								  Invalid Phone Number
							  </div>

                            
							<div class="d-flex justify-content-around mt-4">
							<button id="submitBtn"  type="submit" class="btn btn-primary w-100 fs-6">Register</button>
							<button type="reset" class="btn btn-light w-100 fs-6">
								<small> Reset </small>
                            </button>
							</div>
							</form>

                          <div class="row mt-1">
                            <small> Already registered with us? <a href="login.html">Login</a></small>
                          </div>

                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="footer"></div>

    <script>
        let form = document.getElementById("myForm");
			form.addEventListener("submit", submitted);

        // setting inital state for form validation
        let defaultValidCheck = {
				validFirstName: false,
				validLastName: false,
				validAddress1: false,
				validAddress2: true,
				validPhoneNumber: false,
				checkboxState: false,
				validRegion: false,
				validPincode: false,
				validEmailId: false,
			};

			let validCheck = { ...defaultValidCheck };

        //defining regex expressions for validation
        let regExFirstName = /^[a-zA-Z]+$/;
		let regExLastName = /^[a-zA-Z]+$/;
		let regExAddress = /^[a-zA-Z0-9\s,'-]+$/;
		let regExAddress2 = /^[a-zA-Z0-9\s,'-]*$/;
		let regExPincode = /\b\d{5}\b/;
		let regExEmailId = /([\w\.]+)@northeastern.edu/;
		let regExPhoneNumber = /\d{3}-?\d{3}-?\d{4}$/;

        //adding event listener to fields;
        let firstName = document.getElementById("firstName");
			firstName.addEventListener("input", validate);

			let lastName = document.getElementById("lastName");
			lastName.addEventListener("input", validate);

			let address = document.getElementById("address1");
			address.addEventListener("input", validate);
			let address2 = document.getElementById("address2");
			address2.addEventListener("input", validate);

			let pincode = document.getElementById("pincode");
			pincode.addEventListener("input", validate);

			let emaildId = document.getElementById("emailId");
			emaildId.addEventListener("input", validate);

			let phoneNumber = document.getElementById("phoneNumber");
			phoneNumber.addEventListener("input", validate);

			let checkbox_male = document.getElementById("checkboxMale");
			checkbox_male.addEventListener("input", validate);
			let checkbox_female = document.getElementById("checkboxFemale");
			checkbox_female.addEventListener("input", validate);
			let checkbox_other = document.getElementById("checkboxOtherGender");
			checkbox_other.addEventListener("input", validate);

			let region = document.getElementById("region");
			region.addEventListener("change", regionCheck);
			

			function submitform(e) {
				e.preventDefaults();
				console.log("inside submit function");
				if (Object.values(validCheck).every((ele) => ele)) {
					alert("registered!!");
				} else {
					alert("failed");
				}
			}

			function regionCheck(e) {
				if(e.target.value === "Regions" || e.target.value === null){
					validCheck.validRegion = false;
					console.log("region", e.target.value)
					document.getElementById("error_region").style.display = "block";
					this.style.border = "2px solid red";

				} else {
					console.log("region else", e.target.value)
					validCheck.validRegion = true;
					document.getElementById("error_region").style.display = "none";
					this.style.border = "none";
				}
			}

			function validate(e) {
				let value = e.target.value;
				let type = this.id;
				let em = "error_" + type;

				if (
					checkbox_female.checked ||
					checkbox_male.checked ||
					checkbox_other.checked
				) {
					validCheck.checkboxState = true;
				} else validCheck.checkboxState = false;

				switch (type) {
					case "firstName":
						if (!value.trim().match(regExFirstName)) {
							document.getElementById(em).style.display = "block";
							console.log(this);
							this.style = "border: 2px solid red;";
							validCheck.validFirstName = false;
							console.log("valid first name:", validCheck.validFirstName);
						} else {
							document.getElementById(em).style.display = "none";
							this.style = "border:none";
							validCheck.validFirstName = true;
							console.log("valid first name", validCheck.validFirstName);
						}
						break;

					case "lastName":
						if (!value.trim().match(regExLastName) && !null) {
							document.getElementById(em).style.display = "block";
							this.style = "border: 2px solid red;";
							validCheck.validLastName = false;
							console.log("valid last name:", validCheck.validLastName);
						} else {
							document.getElementById(em).style.display = "none";
							this.style = "border:none";
							validCheck.validLastName = true;
							console.log("valid last name", validCheck.validLastName);
						}
						break;

					case "emailId":
						if (!value.trim().match(regExEmailId)) {
							document.getElementById(em).style.display = "block";
							this.style = "border: 2px solid red;";
							validCheck.validEmailId = false;
							console.log("valid Email ID:", validCheck.validEmailId);
						} else {
							document.getElementById(em).style.display = "none";
							this.style = "border:none";
							validCheck.validEmailId = true;
							console.log("valid Email ID", validCheck.validEmailId);
						}
						break;

					case "phoneNumber":
						if (!value.trim().match(regExPhoneNumber)) {
							document.getElementById(em).style.display = "block";
							this.style = "border: 2px solid red;";
							validCheck.validPhoneNumber = false;
							console.log("valid phone number:", validCheck.validPhoneNumber);
						} else {
							document.getElementById(em).style.display = "none";
							this.style = "border:none";
							validCheck.validPhoneNumber = true;
							console.log("valid phone number", validCheck.validPhoneNumber);
						}
						break;

					case "pincode":
						if (!value.trim().match(regExPincode)) {
							document.getElementById(em).style.display = "block";
							this.style = "border: 2px solid red;";
							validCheck.validPincode = false;
							console.log("valid Zipcode:", validCheck.validPincode);
						} else {
							document.getElementById(em).style.display = "none";
							this.style = "border:none";
							validCheck.validPincode = true;
							console.log("valid Zipcode", validCheck.validPincode);
						}
						break;

					case "address1":
						if (!value.trim().match(regExAddress)) {
							document.getElementById(em).style.display = "block";
							this.style = "border: 2px solid red;";
							validCheck.validAddress1 = false;
							console.log("valid Address 1 :", validCheck.validAddress1);
						} else {
							document.getElementById(em).style.display = "none";
							this.style = "border:none";
							validCheck.validAddress1 = true;
							console.log("valid Address 1 :", validCheck.validAddress1);
						}
						break;

					
					case "address2":
						if (!value.trim().match(regExAddress2)) {
							document.getElementById(em).style.display = "block";
							this.style = "border: 2px solid red;";
							validCheck.validAddress2 = false;
							console.log("valid Address 1 :", validCheck.validAddress2);
						} else {
							document.getElementById(em).style.display = "none";
							this.style = "border:none";
							validCheck.validAddress2 = true;
							console.log("valid Address 1 :", validCheck.validAddress2);
						}
						break;

					default: 
						console.log("default");
						break;
				}
			}

        function setAttributes(element, attrs){
            Object.keys(attrs).forEach( key => element.setAttribute(key, attrs[key]));
        }

        function createToast(role, message) {
            let attributes = {};
            let toastContainer = document.createElement("div");
            attributes = {
                "class": "toast-container position-fixed top-0 start-0 p-3"
            };
            setAttributes(toastContainer, attributes);
            let toast = document.createElement("div");
            attributes = {
                "class": "toast show",
                "role": role,
                "id": "liveToast",
                "aria-live": "assertive",
                "aria-atomic": "true"
            };
            setAttributes(toast, attributes);
            let toastBody = document.createElement("div");
            attributes = {
                "class": "toast-body"
            };
            setAttributes(toastBody, attributes);
            toastBody.innerHTML = message + '<button type="button" class="btn-close float-end" data-bs-dismiss="toast" aria-label="Close"></button>';
            toast.appendChild(toastBody);
            toastContainer.appendChild(toast);

        document.getElementsByTagName("body")[0].appendChild(toastContainer);
        }

        async function submitted(e){
            e.preventDefault();
            if(Object.values(validCheck).every((ele) => ele)){
                window.localStorage.setItem("login", "abcd");
                let btn = document.getElementById("submitBtn");
                
                let spinnerContainer = document.createElement("div");
                attributes = {
                    "class": "spinner-border text-primary",
                    "role": "status"
                };
                setAttributes(spinnerContainer, attributes);
                spinnerContainer.innerHTML = '<span class="visually-hidden">Loading...</span>';
                btn.innerHTML = null;
                btn.appendChild(spinnerContainer);
                btn.setAttribute("disabled", true);
                btn.style = "background-color: #ADADAD;";
               await setTimeout(async () => {
                await setTimeout(() => {
                    window.location.href = "./index.html";
                }, 4000);
                createToast("success", "Registered Successfully");
                }, 2000);
			    

            } else createToast("success", "Registeration unsuccessful");

			console.log("valid checks",validCheck);
        }

    </script>
</body>
</html>