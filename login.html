<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="./css/styles.css" />
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous"><!-- Bootstrap Font Icon CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <!-- Jquery installation -->
    <script
        src="https://code.jquery.com/jquery-3.3.1.js"
        integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
        crossorigin="anonymous"
    ></script>
    <!-- Load header file -->
    <script> 
        $(document).ready(function(){
            $("div#header").load("./header.html");
            $("div#footer").load("./footer.html");
        });
    </script>
</head>
<body>
    <div id="header"></div>

    <main>
        <div class="container d-flex justify-content-center align-items-center min-vh-100">
            <div class="row border rounded-5 p-3 bg-white shadow box-area">
                <!-- left box area -->
                <div class="col-md-6 rounded-5 d-flex justify-content-center align-items-center flex-column">
                    
                    <div id="carouselExampleIndicators" class="carousel slide">
                        <div class="carousel-indicators">
                          <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                          <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
                          <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
                        </div>
                        <div class="carousel-inner">
                          <div class="carousel-item active">
                            <img src="./assets/one.jpg" class="d-block w-100 rounded-5" alt="One">
                          </div>
                          <div class="carousel-item">
                            <img src="./assets/three.jpg" class="d-block w-100 rounded-5" alt="Three">
                          </div>
                          <div class="carousel-item">
                            <img src="./assets/two.jpg" class="d-block w-100 rounded-5" alt="Two">
                          </div>
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                          <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                          <span class="carousel-control-next-icon" aria-hidden="true"></span>
                          <span class="visually-hidden">Next</span>
                        </button>
                      </div>
                </div>

                <!-- right box area -->
                <div class="col-md-6 mt-3">
                    <div class="row align-items-center">
                        <h2>Hello Again!</h2>
                        <p>We are happy to have you back.</p>
                    </div>

                    <div id="myForm" class="inputLogin mt-4">
                        <form>
                            <div class="mb-3">
                              <label for="inputEmailId" class="form-label">Email address</label>
                              <input placeholder="Email Id" type="email" class="form-control bg-light fs-6" id="inputEmailId" aria-describedby="emailHelp">
                            </div>
                            <div id="error_inputEmailId" style="display: none; color:red;">
                                Please enter a valid northeastern email
                            </div>
                            <div class="mb-3">
                              <label for="inputPassword" class="form-label">Password</label>
                              <input placeholder="Password" type="password" class="form-control bg-light fs-6" id="inputPassword">
                            </div>
                            <div id="error_inputPassword" style="display: none; color:red;">
                                must include atleast one uppercase, one lowercase, one number and one special character and 8 characters long
                            </div>
                            <div class="d-flex justify-content-between mt-3 mb-3">
                                <div class="mb-5 form-check">
                                    <input type="checkbox" class="form-check-input" id="exampleCheck1">
                                    <label class="form-check-label" for="exampleCheck1">Remember Me</label>
                                </div>

                                <div class="forgotPassword">
                                    <small> <a href="#"> Forgot Password? </a></small>
                                </div>

                            </div>
                            <button id="submitBtn"  type="submit" class="btn btn-lg btn-primary w-100 fs-6 mt-3">Login</button>
                            <button type="submit" class="btn btn-lg btn-light w-100 fs-6 mt-3">
                                <img src="assets/googleLogo.png" alt="googleLogin" style="width: 20px;">
                                <small> Sign in with google. </small>
                            </button>
                          </form>

                          <div class="row mt-5">
                            <small> Haven't registered with us? <a href="register.html">Sign up</a></small>
                          </div>

                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="footer"></div>

    <script>
        let form = document.getElementById("myForm");
        form.addEventListener("submit", submitted);

        // setting inital state for form validation
        let defaultValidCheck = {
            validEmail: false,
            validPassword: false
        };

        let validCheck = {...defaultValidCheck};

        //defining regex expressions for validation
        let regExEmailId = /([\w\.]+)@northeastern.edu/;
        let regExPassword = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;

        //adding event listener to fields;
        let userName = document.getElementById("inputEmailId");
        userName.addEventListener("input", validate);

        let password = document.getElementById("inputPassword");
        password.addEventListener("input", validate);

        function validate(e){
            let value = e.target.value;
            let type = this.id;
            let em = "error_" + type;

            switch(type){
                case "inputEmailId":
                    if(!value.trim().match(regExEmailId)){
                        document.getElementById(em).style.display = "block";
                        this.style.border = "2px solid red";
                        validCheck.validEmail = false;
                        console.log("valid email id", validCheck.validEmail);
                    } else{
                        document.getElementById(em).style.display = "none";
                        this.style.border = "";
                        validCheck.validEmail = true;
                        console.log("valid email id", validCheck.validEmail);
                    }
                    break;

                case "inputPassword":
                    if(!value.trim().match(regExPassword)){
                        document.getElementById(em).style.display = "block";
                        this.style.border = "2px solid red";
                        validCheck.validPassword = false;
                        console.log("valid email id", validCheck.validPassword);
                    } else {
                        document.getElementById(em).style.display = "none";
                        this.style.border = "";
                        validCheck.validPassword = true;
                        console.log("valid email id", validCheck.validPassword);
                    }
                    break;
            }
        }

        function setAttributes(element, attrs){
            Object.keys(attrs).forEach( key => element.setAttribute(key, attrs[key]));
        }

        function createToast(role, message) {
            let attributes = {};
            let toastContainer = document.createElement("div");
            attributes = {
                "class": "toast-container position-fixed top-0 start-0 p-3"
            };
            setAttributes(toastContainer, attributes);
            let toast = document.createElement("div");
            attributes = {
                "class": "toast show",
                "role": role,
                "id": "liveToast",
                "aria-live": "assertive",
                "aria-atomic": "true"
            };
            setAttributes(toast, attributes);
            let toastBody = document.createElement("div");
            attributes = {
                "class": "toast-body"
            };
            setAttributes(toastBody, attributes);
            toastBody.innerHTML = message + '<button type="button" class="btn-close float-end" data-bs-dismiss="toast" aria-label="Close"></button>';
            toast.appendChild(toastBody);
            toastContainer.appendChild(toast);

            return toastContainer;
        }

        async function submitted(e){
            e.preventDefault();
            if(Object.values(validCheck).every((ele) => ele)){
                window.localStorage.setItem("login", "abcd");
                let btn = document.getElementById("submitBtn");
                
                let spinnerContainer = document.createElement("div");
                attributes = {
                    "class": "spinner-border text-primary",
                    "role": "status"
                };
                setAttributes(spinnerContainer, attributes);
                spinnerContainer.innerHTML = '<span class="visually-hidden">Loading...</span>';
                btn.innerHTML = null;
                btn.appendChild(spinnerContainer);
                btn.setAttribute("disabled", true);
                btn.style = "background-color: #ADADAD;";
               await setTimeout(async () => {
                await setTimeout(() => {
                    window.location.href = "./index.html";
                }, 4000);
                document.getElementsByTagName("body")[0].appendChild(createToast("success", "Logged in Successfully"));
                }, 2000);
			    

            } else alert("please enter valid details");
        }

    </script>
</body>
</html>